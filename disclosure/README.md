# Technology Disclosure

## 概要
ルアー・ライン・スプールで構成されるリール系のキャスト時の状態として、順に遷移する以下の３状態を定義する。
<table>
<tr><th>状態<th>制御方法<th>遷移条件</tr>
<tr><td>①加速状態<td>制御ナシまたは過回転<sup>(2)</sup>抑制<td>張力比較</tr>
<tr><td>②小スパン<sup>(1)</sup>状態<td>スライディングモード制御<td>経過時間</tr>
<tr><td>③大スパン状態 <td>PI-D制御<td>---</tr>
<tr><td colspan="3"><img src="fig01.png" /></tr>
</table>

### 注釈
<dl>
<dt>1)スパン</dt>
<dd>ルアーとロッド間の距離。ピンクのように、この間に水平にラインが張られた系の静力学的な<b>力の釣り合い</b>は、ラインが受ける重力による分布荷重(<i>w</i>)とライン両端での支持力(<i>F</i>)が釣り合っている(下図)。また、支持力(<i>F</i>)はラインの張力に等しい。
<br>
<img src="fig02c.png" width="400"/><br>
重力を受けるラインは、よく知られた懸垂線を描くため常に『ライン長＞スパン』の関係が成立している。ライン長とスパンの差を『ラインスラック(slack:弛み)』と定義したとき、ラインスラックと張力の関係は下図のようになる。<br>
(図左下)ほどラインスラックに対する張力変化が非常に大であり、張力が安定しにくい。一方、スパンがある程度大きくなると(図右下)、勾配は一気に緩やかになり、張力は自然に安定する。</dd>
<dd>
<table>
<tr><td><img src="fig02a.png" width="400"/><td><img src="fig02b.png" width="400"/></tr>
</table>
</dd>
<dt> 2)過回転</dt>
<dd>低慣性スプールで力を入れたキャストをしたとき、スプール速度がルアー速度を上回ることがある。この状態が継続すると、即時にバックラッシュやライン切れが起きる。
</dl>

## 設計
### 状態①加速  
#### 要求実現
1. 低初速(初速が閾値以下)では、スプールの回転を阻害しないよう、ブレーキは完全OFF  
例えば、スプール回転15000RPM以下ではブレーキOFF
2. 高初速(初速が閾値以上)では、強いブレーキを作用しスプール回転を抑制  
スプール回転がルアー速度を超えると、致命的なバックラッシュやライン切れが発生しやすい
初速の高低により、サブ状態を以下のように切り替える。
<table>
<tr><th rowspan="2">サブ状態<th colspan="2">遷移条件
<tr><th>低初速<th>高初速<th>ブレーキ<td rowspan="4"><img src="fig03.png" />
</tr>
<tr><th>1<td>張力&lt;閾値<sub>1</sub><td>スプール回転速度&gt;閾値<sub>2</sub><td>0</tr>
<tr><th>2<td rowspan="2" align="center">↓<td>張力&lt;閾値<sub>1</sub><td>設定1</tr>
<tr><th>3<td>張力 - 張力極小値&gt;閾値<sub>3</sub><td>設定2</tr>
</table>

3. ブレーキ設定1  
1回転のうちのブレーキ作動時間(FETターンオン時間)を指示する。設定プロファイルは無視する。
センサーレスユニットの場合は、次の周期を予測し、その前にターンオフする必要があり、実現には配慮が必要。下記の回転予測時間 <i>&Delta;t<sub>1</sub></i>を求め、最大でもその6/7以下のターンオン時間とする。

$$
\Delta t_1=\frac{v_0-v_0\sqrt(1+\frac{2 \alpha d_0}{v_0^2})}{\alpha}\\
$$
$$
\begin{align}
\alpha&=-\Delta t_0+\Delta t_{-1}\\
v_0&=-\Delta t_0 \Delta t_0+\Delta t_{-1} \Delta t_{-1}+2 \Delta t_0 \Delta t_{-1}\\
d_0&=\Delta t_0 \Delta t_{-1} (\Delta t_0+\Delta t_{-1})\\
\end{align}
$$
近似解として
$$
\Delta t_1=\frac{d_0}{v_0}-\frac{\alpha d_0^2}{4v_0^3}   approx.
$$

### 状態②小スパン  
#### 概要
状態①での制御が成功していれば、この状態の初期には
  - ルアー速度 > スプール速度

が成立している。上記速度条件では、必ずラインを介してルアーとスプールの衝突が起きる。張力波形には、この時発生する力積 *F&Delta;t* が観察されるため、条件成立を確認できる。
<img src="fig04.png" />

#### 要求実現  
1. スライディングモード制御

$$
\sigma=(\beta-\beta_{REF})+\frac{D_{\Theta}\dot{\beta}}{\omega}
$$
スライディングモード制御は、&sigma;(スイッチング関数)の符号により２値に制御入力$U$を切り替える。
$$
U=\begin{cases}
U_{Low} & \sigma>0 &  低デューティ\\
U_{High} & \sigma<0 &  高デューティ
\end{cases}
$$
3. 高デューティ一のアダプテーション
高デューティ一は設定プロファイル$U_{Prof}$を上限に、下式にてアダプテーションする。
$$
U_{High}=\begin{cases}
U_{Prof} - U_{Prof} S_{Adap} & S_{Adap}<S_{Lim}\\
U_{Prof} - U_{Prof} S_{Lim} & S_{Adap}>S_{Lim}
\end{cases}
$$
$$
\begin{cases}
S_{Lim}:アダプテーション上限値\\
S_{Adap}=k_{Adap} \Sigma \beta_{\sigma>0} \Delta t
\end{cases}
$$

### 状態③スパン大  
#### 概要
状態②での制御が成功していれば、適度なライン弛みが保たれており、またデューティも決定されている。このため、その後は微調整を行うのみであるが、張力がほぼ０の領域での制御となるため、ゼロ点ズレなど誤差の影響が大である。このため「ライン張度」という評価基準を導入する。
<img src="fig05.png" />

#### 要求実現  

1. PI-D制御  
PI制御にディザリング(Dithering)を組み合わせた、PI-D制御にてデューティの微調整を行う。PI制御のフィードバックは、張力ではなく後述の「ライン張り度」とする。

2. ディザリング  
ディザリングとは信号に意図的にノイズ(ディザー)を加えることであり、本件ではブレーキデューティに一定周期(5Hz)の三角波ディザーを加える。ディザーの目的は、ディザーに対する張力応答を観測し、これを数値化してライン張度を得るためである。
<img src="fig06.png" />

3. ライン張度  
上図に示すように、振幅Aのディザーをブレーキに加えたときの張力応答は、張力が高いときには振幅B<sub>1</sub>、張力が低いときには振幅B<sub>2</sub>、となり同じディザー振幅に対して応答振幅が大きく変わる。この特性を利用してラインの張り具合を数値化したものが「ライン張り度」である。

4. 高次回帰フィルター  
ディザーに因るもの以外の張力変動は、フィルターでカットする必要がある。この手順は、ディザー周期と同じウインドウに張力観測値を切り出し、このデータに対して高次の回帰式を求め、回帰式に対する張力の標準偏差を求める。これを『ライン張り度』と定義する。結果的に、5Hz〜オブザーバ応答周波数までの張力の変動の代表値となる。
<img src="fig07.png" width="50%"/>
